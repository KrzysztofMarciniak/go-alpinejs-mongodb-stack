SecRuleEngine On
SecAuditLog /var/log/nginx/modsec_audit.log
SecAuditLogParts ABIJDEFHZ
SecAuditLogType Serial
SecAuditLogFormat JSON
Include /etc/modsecurity/modsecurity.conf
SecRule REQUEST_HEADERS:Content-Type "application/json" \
    "id:200001,phase:1,t:none,t:lowercase,pass,nolog,ctl:requestBodyProcessor=JSON"
SecRule REQUEST_METHOD "POST" "chain,id:200003,phase:2,deny,status:400,log,msg:'Empty POST body'"
SecRule REQBODY_PROCESSOR "!@rx JSON" "t:none"
SecRule REQUEST_URI "@rx (\.\./|\.\.\\|%2e%2e)" \
    "id:200005,phase:2,deny,status:403,msg:'Path traversal attempt detected',log"
SecRule REQUEST_HEADERS:User-Agent "@rx (sqlmap|nmap|nikto)" \
    "id:200006,phase:1,deny,status:403,msg:'Scanner detected in User-Agent',log"
SecRequestBodyAccess On
SecRequestBodyLimit 52428800
SecRequestBodyNoFilesLimit 52428800
SecRequestBodyLimitAction Reject
SecRequestBodyJsonDepthLimit 512
SecArgumentsLimit 1000
SecDefaultAction "phase:2,deny,log,status:403"
